{% extends 'shop/base.html' %}

{% block content %}
<section class="catalog">
  <h2 class="catalog__section-header section-header">Популярное</h2>
  <div class="catalog__wrapper">
    {% for post in posts %}
    <figure class="catalog__item">
      <figcaption class="catalog__title">{{post.title}}</figcaption>
        {% if post.photo %}
        <div class="catalog__image-wrapper">
          <img alt="изображение {{post.title}}"
          height="347" src="{{post.photo.url}}" width="258" class="catalog__image">
        </div>
        {% else %}
        <div class="catalog__image-wrapper">
          <img alt="изображение {{post.title}}"
          height="347" src="../../static/shop/img/notavailable2.jpg" width="258" class="catalog__image">
        </div>
        {% endif %}
        <a href="{{ post.get_absolute_url }}" class="button catalog__button">Открыть</a>

        {% if request.user.is_authenticated %}

        {% if  post.stock %}
          {%  if post not in cart.products_in_cart %}
            <a href="{% url 'add_to_cart' ct_model=post.ct_model slug=post.slug %}" class="btn btn-primary">
              Добавить в корзину
            </a>
          {% else %}
            <p class="btn btn-default">Добавлен в корзину</з>
          {% endif %}
          {% else %}
          {% if post not in request.user.customer.wishlist.all %}
              <a href="{% url 'add_to_wishlist' post_id=post.id %}">Добавить в ожидаемое</a>
          {% else %}
              <a href="#" class="btn btn-default" disabled="">Добавлен в ожидаемое</a>
          {% endif %}
        {% endif %}
      {% endif %}


    </figure>
    {% endfor %}
  </div>
</section>
{% endblock %}
