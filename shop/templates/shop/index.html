{% extends 'shop/base.html' %}

{% block content %}
<section class="catalog">
  <h2 class="catalog__section-header section-header">Популярное</h2>
  <div class="catalog__wrapper">
    {% for post in posts %}
    <figure class="catalog__item">
      <figcaption class="catalog__title">{{post.title}}</figcaption>
        {% if post.photo %}
        <div class="catalog__image-wrapper">
          <img alt="изображение {{post.title}}"
          height="347" src="{{post.photo.url}}" width="258" class="catalog__image">
        </div>
        {% else %}
        <div class="catalog__image-wrapper">
          <img alt="изображение {{post.title}}"
          height="347" src="../../static/shop/img/notavailable2.jpg" width="258" class="catalog__image">
        </div>
        {% endif %}
        <a href="{{ post.get_absolute_url }}" class="button catalog__button">Открыть</a>

        {% if request.user.is_authenticated %}

        {% if  post.stock %}
          {%  if post not in cart.products_in_cart %}
            <a href="{% url 'add_to_cart' ct_model=post.ct_model slug=post.slug %}" class="btn btn-primary cart_add_btn">
              <span class="visually-hidden">Добавить в корзину</span> 
            </a>
          {% else %}
          <a class="cart__counter" href="{% url 'change_up' ct_model=post.ct_model slug=post.slug %}">
            <span class="visually-hidden">Увеличить</span>
            <svg class="icon icon--counter" width="41" height="39" viewBox="0 0 41 39"
                fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M25.102 24.29L20.886 38.674H20.018L15.244 24.29L0.488 19.764V19.144L15.244 14.928L20.018 0.729998H20.886L25.102 14.928L40.23 19.144V19.764L25.102 24.29Z"
                    fill="white" />
            </svg>
        </a>
          <span class="visually-hidden">Уменьшить</span>
          <svg class="icon icon--counter" width="27" height="13" viewBox="0 0 27 13" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path d="M0.976 12.964V0.749998L26.644 6.454V6.888L0.976 12.964Z" fill="white" />
          </svg>
      </a>
      <a class="cart__delete-btn" href="{% url 'delete_from_cart' ct_model=post.ct_model slug=post.slug %}"">
        <span class="visually-hidden">Удалить</span>
    </a>
          {% endif %}
          {% else %}
          {% if post not in request.user.customer.wishlist.all %}
              <a href="{% url 'add_to_wishlist' post_id=post.id %}">Добавить в ожидаемое</a>
          {% else %}
              <a href="#" class="btn btn-default" disabled="">Добавлен в ожидаемое</a>
          {% endif %}
        {% endif %}
        {% else %}
        <a href="{% url 'login' %}" class="btn btn-primary cart_add_btn">
          <span class="visually-hidden">Добавить в корзину</span>
        </a>
      {% endif %}


    </figure>
    {% endfor %}
  </div>
</section>
{% endblock %}
